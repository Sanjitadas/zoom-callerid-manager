<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>{% block title %}BlackBox CID Portal{% endblock %}</title>

<!-- Bootstrap & icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
  :root{
    --brand-blue:#1f3c88;
    --brand-blue-2:#3b54b1;
    --muted:#6c757d;
    --card-radius:12px;
  }
  html,body{height:100%}
  body {
    background: #f4f6f9;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    margin:0;
  }

  /* top navbar */
  .topbar {
    background: white;
    border-bottom: 1px solid #e9ecef;
    height:64px;
    display:flex;
    align-items:center;
    padding:0 18px;
    position:sticky;
    top:0;
    z-index:1100;
  }

  .brand {
    display:flex;
    align-items:center;
    gap:.5rem;
  }
  .brand .logo {
    width:36px; height:36px; border-radius:6px;
    background: linear-gradient(135deg,var(--brand-blue),var(--brand-blue-2));
  }

  /* profile dropdown */
  .profile-avatar {
    width:40px; height:40px; border-radius:50%;
    background: linear-gradient(135deg,#9aa7ee,#6f8bf1);
    display:inline-flex; align-items:center; justify-content:center; color:white;
    font-weight:700;
  }

  /* layout */
  .app-layout { display:flex; min-height:calc(100vh - 64px); }
  .sidebar {
    width:220px; background:var(--brand-blue); color:#fff; padding-top:18px;
    flex-shrink:0; transition:width .2s;
    position:fixed; top:64px; bottom:0; left:0; overflow:auto;
  }
  .sidebar .nav-link { color:rgba(255,255,255,0.95); border-radius:8px; padding:10px 14px; margin:6px 8px; display:flex; align-items:center; gap:.6rem; }
  .sidebar .nav-link:hover, .sidebar .nav-link.active { background:rgba(255,255,255,0.08); text-decoration:none; }

  .content {
    flex:1; margin-left:220px; padding:24px; padding-top:28px;
  }

  .no-sidebar .content { margin-left:0; }

  .card-rounded { border-radius: var(--card-radius); }

  @media(max-width:991px){
    .sidebar { position:fixed; left:-100%; top:64px; z-index:1150; }
    .sidebar.open { left:0; }
    .content { margin-left:0; padding:16px; }
  }

  .flash-auto { transition: opacity .35s ease; }
</style>
</head>
<body>

<!-- Topbar -->
<header class="topbar d-flex justify-content-between align-items-center">
  <div class="d-flex align-items-center gap-3">
    <button id="sidebarToggle" class="btn btn-sm btn-outline-secondary d-lg-none" type="button" aria-label="Toggle sidebar">
      <i class="bi bi-list"></i>
    </button>

    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
    </div>
  </div>

  <div class="d-flex align-items-center gap-3">
    <div class="dropdown me-2">
      <a class="text-muted" href="#" id="notifToggle" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-bell fs-5"></i></a>
      <ul class="dropdown-menu dropdown-menu-end p-2" aria-labelledby="notifToggle" style="min-width:260px;">
        <li class="small text-muted px-2 mb-2">Notifications</li>
        <li><hr class="dropdown-divider"></li>
        <li class="px-2"><div class="small">No new notifications</div></li>
      </ul>
    </div>

    {% if session.get('user_email') %}
    <div class="dropdown profile-dropdown">
      <a class="d-flex align-items-center text-decoration-none" href="#" id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
        <div class="profile-avatar me-2">
          {{ session.get('user_email')[0:1]|upper }}
        </div>
        <div class="d-none d-md-block text-dark small">
          {{ session.get('user_email') }}
        </div>
      </a>

      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
        <li class="px-3 py-2">
          <div class="small text-muted">Signed in as</div>
          <div class="fw-semibold">{{ session.get('user_email') }}</div>
        </li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="{{ url_for('main.index') }}">View Profile</a></li>
        <li><a class="dropdown-item text-danger" href="{{ url_for('main.logout') }}"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
      </ul>
    </div>
    {% else %}
      <a class="btn btn-sm btn-outline-primary" href="{{ url_for('auth.login') }}">Login</a>
    {% endif %}
  </div>
</header>

<!-- Page layout -->
<div class="app-layout {% if not session.get('role') or session.get('role') != 'admin' %} no-sidebar {% endif %}">
  {% if session.get('role') == 'admin' %}
  <aside id="mainSidebar" class="sidebar">
    <div class="px-3">
      <h5 class="text-white ps-2">Zoom CID Manager</h5>
    </div>

    <nav class="mt-3">
      <a class="nav-link {% if request.endpoint == 'main.index' %}active{% endif %}" href="{{ url_for('main.index') }}">
        <i class="bi bi-speedometer2"></i> Dashboard
      </a>
      <a class="nav-link {% if request.endpoint == 'main.manage_admins_access' %}active{% endif %}" href="{{ url_for('main.manage_admins_access') }}">
        <i class="bi bi-people"></i> Admins & Users
      </a>
      <a class="nav-link {% if request.endpoint == 'main.bulk_update' %}active{% endif %}" href="{{ url_for('main.bulk_update') }}">
         <i class="bi bi-upc-scan"></i> Outbound Caller ID
      </a>
    </nav>
  </aside>
  {% endif %}

  <main class="content">
    <div id="flashContainer">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ 'warning' if category=='warning' else category }} alert-dismissible fade show flash-auto" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}
    </div>

    {% block content %}{% endblock %}
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const sidebar = document.getElementById('mainSidebar');
  const toggleBtn = document.getElementById('sidebarToggle');
  if(toggleBtn){
    toggleBtn.addEventListener('click', ()=> {
      if(sidebar) sidebar.classList.toggle('open');
    });
  }

  window.addEventListener('DOMContentLoaded', ()=> {
    document.querySelectorAll('.flash-auto').forEach(el=>{
      setTimeout(()=> {
        el.classList.remove('show');
        el.classList.add('hide');
        try{ el.remove(); } catch(e){}
      }, 4000);
    });
  });
</script>
</body>
</html>










































